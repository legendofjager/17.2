#include "TASK.h"

// Функция извлечения подстроки с поддержкой отрицательных индексов
// arr - исходная строка (вводится с клавиатуры)
// buf - буфер для результата
// n - начальный индекс (отрицательный = отсчет с конца)
// m - длина извлекаемой подстроки
// len - длина исходной строки
char *mading(char *arr, char *buf, int n, int m, size_t len) {
    char *change = buf;  // Сохраняем оригинальный указатель на буфер

    // Корректировка отрицательных индексов
    if (n < 0) {
        // Преобразование отрицательного индекса в положительный
        n = len + n;

        // Обработка отрицательной длины
        if (m < 0) {
            m = -m;
            n = n - m + 1;

            // Коррекция выхода за левую границу
            if (n < 0) {
                m += n;
                n = 0;
            }
        }
    } else {
        // Обработка отрицательной длины для положительного n
        if (m < 0) {
            m = -m;
            n = n - m + 1;

            // Коррекция выхода за левую границу
            if (n < 0) {
                m += n;
                n = 0;
            }
        }
    }

    // Специальный случай: m=0 означает "до конца строки"
    if (m == 0) {
        m = len;
    }

    // Некорректные параметры - возвращаем пустую строку
    if (m < 0) {
        *buf = '\0';
        return change;
    }

    // Проверка допустимости диапазона
    if (n >= 0 && n < len) {
        char *start = arr + n;
        char *end = arr + n + m;

        // Копирование символов в буфер
        for (char *i = start; i < end && i < arr + len && *i != '\0'; i++) {
            *buf++ = *i;
        }
    }

    *buf = '\0';  // Завершаем строку нулевым символом
    return change;  // Возвращаем указатель на начало буфера
}
